readDS('~/Desktop/annenbergdata/fiveyearacs/acs_ps.rds')
readr::readDS('~/Desktop/annenbergdata/fiveyearacs/acs_ps.rds')
dplyr::readDS('~/Desktop/annenbergdata/fiveyearacs/acs_ps.rds')
dplyr::readRDS('~/Desktop/annenbergdata/fiveyearacs/acs_ps.rds')
acs_ps=dplyr::readRDS("~/Desktop/annenbergdata/fiveyearacs/acs_ps.rds")
acs_ps=readRDS("~/Desktop/annenbergdata/fiveyearacs/acs_ps.rds")
acs_ps
rm(list=ls())
# for 5 YEAR ACS 2006 - 2010
#load into the ACS and make PS table.
library(dplyr)
library(readr)
library(data.table)
# load data
acs1 = fread("~/Desktop/annenbergdata/fiveyearacs/csv_pus/ss10pusa.csv", sep = ",", header =TRUE)
acs1 = acs1[acs1$AGEP>17,]
acs1_tr = acs1[,c("serialno",
"AGEP", # age
"SEX", # sex
"PWGTP", # person's weight
"HISP", # hispanic ethnicity
"RAC1P", # race
"ST", # state
"SCHL", # Educational attainment,
"RT" # record type
)]
rm(acs1)
gc() # free up space
acs2 = fread("~/Desktop/annenbergdata/fiveyearacs/csv_pus/ss10pusb.csv", sep = ",", header =TRUE)
acs2 = acs2[acs2$AGEP>17,]
acs2_tr = acs2[,c("serialno",
"AGEP", # age
"SEX", # sex
"PWGTP", # person's weight
"HISP", # hispanic ethnicity: FOR RACE
"RAC1P", # race: FOR RACE
"ST", # state
"SCHL", # Educational attainment
"RT" # record type
)]
rm(acs2)
gc() # free up space
acs3 = fread("~/Desktop/annenbergdata/fiveyearacs/csv_pus/ss10pusc.csv", sep = ",", header =TRUE)
acs3 = acs3[acs3$AGEP>17,]
acs3_tr = acs3[,c("serialno",
"AGEP", # age
"SEX", # sex
"PWGTP", # person's weight
"HISP", # hispanic ethnicity
"RAC1P", # race
"ST", # state
"SCHL", # Educational attainment
"RT"
)]
rm(acs3)
gc()
acs4 = fread("~/Desktop/annenbergdata/fiveyearacs/csv_pus/ss10pusd.csv", sep = ",", header =TRUE)
acs4 = acs4[acs4$AGEP>17,]
acs4_tr = acs4[,c("serialno",
"AGEP", # age
"SEX", # sex
"PWGTP", # person's weight
"HISP", # hispanic ethnicity: FOR RACE
"RAC1P", # race: FOR RACE
"ST", # state
"SCHL", # Educational attainment,
"RT"
)]
rm(acs4)
gc()
acs_tr = rbind(acs1_tr, acs2_tr, acs3_tr, acs4_tr)
acsh1 = fread("~/Desktop/annenbergdata/fiveyearacs/csv_hus/ss10husa.csv", sep = ",", header =TRUE)
acsh1_tr = acsh1[,c("serialno", "HINCP")]
rm(acsh1)
gc()
acsh2 = fread("~/Desktop/annenbergdata/fiveyearacs/csv_hus/ss10husb.csv", sep = ",", header =TRUE)
acsh2_tr = acsh2[,c("serialno","HINCP")]
rm(acsh2)
gc()
acsh3 = fread("~/Desktop/annenbergdata/fiveyearacs/csv_hus/ss10husc.csv", sep = ",", header =TRUE)
acsh3_tr = acsh3[,c("serialno","HINCP")]
rm(acsh3)
gc()
acsh4 = fread("~/Desktop/annenbergdata/fiveyearacs/csv_hus/ss10husd.csv", sep = ",", header =TRUE)
acsh4_tr = acsh4[,c("serialno","HINCP")]
rm(acsh4)
gc()
sum(names(acsh1)==names(acsh2))
sum(names(acsh2)==names(acsh3))
sum(names(acsh3)==names(acsh4))
acsh_tr = rbind(acsh1_tr, acsh2_tr, acsh3_tr, acsh4_tr)
# check that there are no duplicate rows in acsh_tr
print(length(unique(acsh_tr$serialno)))
print(dim(acsh_tr))
acs_tr = dplyr::left_join(acs_tr, acsh_tr, by = c("serialno"="serialno"))
rm(acs1_tr, acs2_tr, acs3_tr, acs4_tr)
rm(acsh1_tr, acsh2_tr, acsh3_tr, acsh4_tr)
acs_tr = acs_tr[complete.cases(acs_tr),] # remove NAs
acs_tr$race_x = ifelse(acs_tr$RAC1P==1 & acs_tr$HISP==1,"white",
ifelse(acs_tr$RAC1P==2 & acs_tr$HISP==1,"black",
ifelse(acs_tr$RAC1P==6 & acs_tr$HISP==1, "asian",
ifelse(acs_tr$RAC1P==3 & acs_tr$HISP==1,"americanindian",
ifelse(!(acs_tr$RAC1P %in% c(1,2,6,3)) & acs_tr$HISP %in% 2:24, "hisp",
"other")
)
)
)
)
acs_tr$education_x = ifelse(acs_tr$SCHL %in% 1:8, "nohighschool",
ifelse(acs_tr$SCHL==9, "highschool",
ifelse(acs_tr$SCHL %in% c(10,11), "somecollege",
ifelse(acs_tr$SCHL==12, "twoyeardegree",
ifelse(acs_tr$SCHL==13, "fouryeardegree",
"fouryeardegreeplus")
)
)
)
)
# DOUBLE CHECK BELOW
acs_tr$state_x = case_when(acs_tr$ST == 1 ~ "alabama",
acs_tr$ST == 2 ~ "alaska",
acs_tr$ST == 4 ~ "arizona",
acs_tr$ST == 5 ~ "arkansas",
acs_tr$ST == 6 ~ "california",
acs_tr$ST == 8 ~ "colorado",
acs_tr$ST == 9 ~ "connecticut",
acs_tr$ST == 10 ~ "delaware",
acs_tr$ST == 11 ~ "columbia",
acs_tr$ST == 12 ~ "florida",
acs_tr$ST == 13 ~ "georgia",
acs_tr$ST == 15 ~ "hawaii",
acs_tr$ST == 16 ~ "idaho",
acs_tr$ST == 17 ~ "illinois",
acs_tr$ST == 18 ~ "indiana",
acs_tr$ST == 19 ~ "iowa",
acs_tr$ST == 20 ~ "kansas",
acs_tr$ST == 21 ~ "kentucky",
acs_tr$ST == 22 ~ "louisiana",
acs_tr$ST == 23 ~ "maine",
acs_tr$ST == 24 ~ "maryland",
acs_tr$ST == 25 ~ "massachusetts",
acs_tr$ST == 26 ~ "michigan",
acs_tr$ST == 27 ~ "minnesota",
acs_tr$ST == 28 ~ "mississippi",
acs_tr$ST == 29 ~ "missouri",
acs_tr$ST == 30 ~ "montana",
acs_tr$ST == 31 ~ "nebraska",
acs_tr$ST == 32 ~ "nevada",
acs_tr$ST == 33 ~ "newhampshire",
acs_tr$ST == 34 ~ "newjersey",
acs_tr$ST == 35 ~ "newmexico",
acs_tr$ST == 36 ~ "newyork",
acs_tr$ST == 37 ~ "northcarolina",
acs_tr$ST == 38 ~ "northdakota",
acs_tr$ST == 39 ~ "ohio",
acs_tr$ST == 40 ~ "oklahoma",
acs_tr$ST == 41 ~ "oregon",
acs_tr$ST == 42 ~ "pennsylvania",
acs_tr$ST == 44 ~ "rhodeisland",
acs_tr$ST == 45 ~ "southcarolina",
acs_tr$ST == 46 ~ "southdakota",
acs_tr$ST == 47 ~ "tennessee",
acs_tr$ST == 48 ~ "texas",
acs_tr$ST == 49 ~ "utah",
acs_tr$ST == 50 ~ "vermont",
acs_tr$ST == 51 ~ "virginia",
acs_tr$ST == 53 ~ "washington",
acs_tr$ST == 54 ~ "westvirginia",
acs_tr$ST == 55 ~ "wisconsin",
acs_tr$ST == 56 ~ "wyoming",
TRUE ~ as.character(acs_tr$ST))
# PREPROCESS INCOME
# match annenberg coding
acs_tr$income_x = case_when(acs_tr$HINCP < 10000 ~ 1,
acs_tr$HINCP >= 10000 & acs_tr$HINCP < 15000 ~ 2,
acs_tr$HINCP >= 15000 & acs_tr$HINCP < 25000 ~ 3,
acs_tr$HINCP >= 25000 & acs_tr$HINCP < 35000 ~ 4,
acs_tr$HINCP >= 35000 & acs_tr$HINCP < 50000 ~ 5,
acs_tr$HINCP >= 50000 & acs_tr$HINCP < 75000 ~ 6,
acs_tr$HINCP >= 75000 & acs_tr$HINCP < 100000 ~ 7,
acs_tr$HINCP >= 100000 & acs_tr$HINCP < 150000 ~ 8,
acs_tr$HINCP >= 150000 ~ 9)
# 1. do dplyr grouping
acs_ps = acs_tr %>%
group_by(AGEP, SEX, race_x, education_x, state_x, income_x) %>%
summarize(N = sum(PWGTP)) %>% # why sum over PWGTP?
ungroup()
acs_ps
gc()
# load data
acs1 = fread("~/Desktop/annenbergdata/fiveyearacs/csv_pus/ss10pusa.csv", sep = ",", header =TRUE)
acs1 = acs1[acs1$AGEP>17,]
acs1_tr = acs1[,c("serialno",
"AGEP", # age
"SEX", # sex
"PWGTP", # person's weight
"HISP", # hispanic ethnicity
"RAC1P", # race
"ST", # state
"SCHL", # Educational attainment,
"RT" # record type
)]
rm(acs1)
gc() # free up space
acs2 = fread("~/Desktop/annenbergdata/fiveyearacs/csv_pus/ss10pusb.csv", sep = ",", header =TRUE)
acs2 = acs2[acs2$AGEP>17,]
acs2_tr = acs2[,c("serialno",
"AGEP", # age
"SEX", # sex
"PWGTP", # person's weight
"HISP", # hispanic ethnicity: FOR RACE
"RAC1P", # race: FOR RACE
"ST", # state
"SCHL", # Educational attainment
"RT" # record type
)]
rm(acs2)
gc() # free up space
acs3 = fread("~/Desktop/annenbergdata/fiveyearacs/csv_pus/ss10pusc.csv", sep = ",", header =TRUE)
acs3 = acs3[acs3$AGEP>17,]
acs3_tr = acs3[,c("serialno",
"AGEP", # age
"SEX", # sex
"PWGTP", # person's weight
"HISP", # hispanic ethnicity
"RAC1P", # race
"ST", # state
"SCHL", # Educational attainment
"RT"
)]
rm(acs3)
gc()
acs4 = fread("~/Desktop/annenbergdata/fiveyearacs/csv_pus/ss10pusd.csv", sep = ",", header =TRUE)
acs4 = acs4[acs4$AGEP>17,]
acs4_tr = acs4[,c("serialno",
"AGEP", # age
"SEX", # sex
"PWGTP", # person's weight
"HISP", # hispanic ethnicity: FOR RACE
"RAC1P", # race: FOR RACE
"ST", # state
"SCHL", # Educational attainment,
"RT"
)]
rm(acs4)
gc()
acs_tr = rbind(acs1_tr, acs2_tr, acs3_tr, acs4_tr)
acsh1 = fread("~/Desktop/annenbergdata/fiveyearacs/csv_hus/ss10husa.csv", sep = ",", header =TRUE)
acsh1_tr = acsh1[,c("serialno", "HINCP")]
acsh2 = fread("~/Desktop/annenbergdata/fiveyearacs/csv_hus/ss10husb.csv", sep = ",", header =TRUE)
acsh2_tr = acsh2[,c("serialno","HINCP")]
acsh3 = fread("~/Desktop/annenbergdata/fiveyearacs/csv_hus/ss10husc.csv", sep = ",", header =TRUE)
acsh3_tr = acsh3[,c("serialno","HINCP")]
acsh4 = fread("~/Desktop/annenbergdata/fiveyearacs/csv_hus/ss10husd.csv", sep = ",", header =TRUE)
acsh4_tr = acsh4[,c("serialno","HINCP")]
sum(names(acsh1)==names(acsh2))
sum(names(acsh2)==names(acsh3))
sum(names(acsh3)==names(acsh4))
names(acsh1)==names(acsh2)
length(names(acsh1))
acsh_tr = rbind(acsh1_tr, acsh2_tr, acsh3_tr, acsh4_tr)
# check that there are no duplicate rows in acsh_tr
print(length(unique(acsh_tr$serialno)))
print(dim(acsh_tr))
acs_tr = dplyr::left_join(acs_tr, acsh_tr, by = c("serialno"="serialno"))
rm(acs1_tr, acs2_tr, acs3_tr, acs4_tr)
rm(acsh1_tr, acsh2_tr, acsh3_tr, acsh4_tr)
rm(acsh1)
gc()
rm(acsh2)
gc()
rm(acsh3)
gc()
rm(acsh4)
gc()
acs_tr = acs_tr[complete.cases(acs_tr),] # remove NAs
acs_tr$race_x = ifelse(acs_tr$RAC1P==1 & acs_tr$HISP==1,"white",
ifelse(acs_tr$RAC1P==2 & acs_tr$HISP==1,"black",
ifelse(acs_tr$RAC1P==6 & acs_tr$HISP==1, "asian",
ifelse(acs_tr$RAC1P==3 & acs_tr$HISP==1,"americanindian",
ifelse(!(acs_tr$RAC1P %in% c(1,2,6,3)) & acs_tr$HISP %in% 2:24, "hisp",
"other")
)
)
)
)
acs_tr$education_x = ifelse(acs_tr$SCHL %in% 1:8, "nohighschool",
ifelse(acs_tr$SCHL==9, "highschool",
ifelse(acs_tr$SCHL %in% c(10,11), "somecollege",
ifelse(acs_tr$SCHL==12, "twoyeardegree",
ifelse(acs_tr$SCHL==13, "fouryeardegree",
"fouryeardegreeplus")
)
)
)
)
# DOUBLE CHECK BELOW
acs_tr$state_x = case_when(acs_tr$ST == 1 ~ "alabama",
acs_tr$ST == 2 ~ "alaska",
acs_tr$ST == 4 ~ "arizona",
acs_tr$ST == 5 ~ "arkansas",
acs_tr$ST == 6 ~ "california",
acs_tr$ST == 8 ~ "colorado",
acs_tr$ST == 9 ~ "connecticut",
acs_tr$ST == 10 ~ "delaware",
acs_tr$ST == 11 ~ "columbia",
acs_tr$ST == 12 ~ "florida",
acs_tr$ST == 13 ~ "georgia",
acs_tr$ST == 15 ~ "hawaii",
acs_tr$ST == 16 ~ "idaho",
acs_tr$ST == 17 ~ "illinois",
acs_tr$ST == 18 ~ "indiana",
acs_tr$ST == 19 ~ "iowa",
acs_tr$ST == 20 ~ "kansas",
acs_tr$ST == 21 ~ "kentucky",
acs_tr$ST == 22 ~ "louisiana",
acs_tr$ST == 23 ~ "maine",
acs_tr$ST == 24 ~ "maryland",
acs_tr$ST == 25 ~ "massachusetts",
acs_tr$ST == 26 ~ "michigan",
acs_tr$ST == 27 ~ "minnesota",
acs_tr$ST == 28 ~ "mississippi",
acs_tr$ST == 29 ~ "missouri",
acs_tr$ST == 30 ~ "montana",
acs_tr$ST == 31 ~ "nebraska",
acs_tr$ST == 32 ~ "nevada",
acs_tr$ST == 33 ~ "newhampshire",
acs_tr$ST == 34 ~ "newjersey",
acs_tr$ST == 35 ~ "newmexico",
acs_tr$ST == 36 ~ "newyork",
acs_tr$ST == 37 ~ "northcarolina",
acs_tr$ST == 38 ~ "northdakota",
acs_tr$ST == 39 ~ "ohio",
acs_tr$ST == 40 ~ "oklahoma",
acs_tr$ST == 41 ~ "oregon",
acs_tr$ST == 42 ~ "pennsylvania",
acs_tr$ST == 44 ~ "rhodeisland",
acs_tr$ST == 45 ~ "southcarolina",
acs_tr$ST == 46 ~ "southdakota",
acs_tr$ST == 47 ~ "tennessee",
acs_tr$ST == 48 ~ "texas",
acs_tr$ST == 49 ~ "utah",
acs_tr$ST == 50 ~ "vermont",
acs_tr$ST == 51 ~ "virginia",
acs_tr$ST == 53 ~ "washington",
acs_tr$ST == 54 ~ "westvirginia",
acs_tr$ST == 55 ~ "wisconsin",
acs_tr$ST == 56 ~ "wyoming",
TRUE ~ as.character(acs_tr$ST))
# PREPROCESS INCOME
# match annenberg coding
acs_tr$income_x = case_when(acs_tr$HINCP < 10000 ~ 1,
acs_tr$HINCP >= 10000 & acs_tr$HINCP < 15000 ~ 2,
acs_tr$HINCP >= 15000 & acs_tr$HINCP < 25000 ~ 3,
acs_tr$HINCP >= 25000 & acs_tr$HINCP < 35000 ~ 4,
acs_tr$HINCP >= 35000 & acs_tr$HINCP < 50000 ~ 5,
acs_tr$HINCP >= 50000 & acs_tr$HINCP < 75000 ~ 6,
acs_tr$HINCP >= 75000 & acs_tr$HINCP < 100000 ~ 7,
acs_tr$HINCP >= 100000 & acs_tr$HINCP < 150000 ~ 8,
acs_tr$HINCP >= 150000 ~ 9)
# 1. do dplyr grouping
acs_ps = acs_tr %>%
group_by(AGEP, SEX, race_x, education_x, state_x, income_x) %>%
summarize(N = sum(PWGTP)) %>% # why sum over PWGTP?
ungroup()
